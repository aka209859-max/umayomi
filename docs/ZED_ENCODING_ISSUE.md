# ⚠️ 緊急報告：ZEDファイルのエンコーディング問題

## 🔍 問題の発見

Sandbox内の `/home/user/uploaded_files/ZED*.txt` ファイルは：
- ✅ **UTF-8にすでに変換されている**
- ❌ **変換時にShift-JISの文字が破損**（置換文字 � だらけ）
- ❌ **レース名、馬名、騎手名などが読めない**

### 証拠
```
Raw bytes: ef bf bd (= UTF-8の置換文字 U+FFFD �)
Expected: Shift-JISの日本語文字
```

---

## 📊 判明した構造（数値部分）

### 基本情報（位置0-26）
```
[0-2]   場コード:     "06" (東京)
[2-4]   レース番号:   "24"
[4-10]  日付情報:     "540111" (曜日、月、日)
[10-18] レースID:     "22101022"
[18-26] 開催年月日:   "20241208"
```

### 数値データ部分（位置200-350）
```
Position 200-250: 指数、スコア
  例: "433833MS-27.6 -9.5-19.5  3.5"
  
Position 250-300: 馬ID、タイム
  例: "T010361376     9.4  48.7  "
  
Position 300-350: オッズ、着順、通過順位
  例: " 6.300121010-22-221062610488406-021 3"
```

---

## 🚀 解決策（3つの選択肢）

### Option 1: CEOに元のShift-JISファイルを要求（推奨20分）

**必要なファイル**:
```
E:\UMAYOMI\jrdb_data\PACI*\ZED*.txt
```

**手順**:
1. CEOがPowerShellで以下を実行：
   ```powershell
   # ZEDファイルのリスト作成
   Get-ChildItem E:\UMAYOMI\jrdb_data\PACI*\ZED*.txt | 
     Select-Object FullName | 
     Out-File -FilePath E:\zed_files_list.txt
   
   # 最初の5ファイルをコピー（テスト用）
   $files = Get-ChildItem E:\UMAYOMI\jrdb_data\PACI*\ZED*.txt | Select-Object -First 5
   foreach ($file in $files) {
       Copy-Item $file.FullName -Destination E:\test_zed\
   }
   ```

2. `E:\test_zed\` の5ファイルを共有
3. Shift-JISパーサーをテスト
4. 成功したら全1,265ファイルを取り込み

**メリット**:
- ✅ **完全なデータ取得**（馬名、騎手名など）
- ✅ **最も正確**

**デメリット**:
- ⏱️ ファイル転送が必要

---

### Option 2: 数値データのみで進める（推奨30分）

**現在のUTF-8ファイルから数値データだけを抽出**

**取得可能なデータ**:
- ✅ 場コード、レース番号、開催年月日
- ✅ オッズ、着順、人気
- ✅ 各種指数、スコア
- ✅ タイム、通過順位
- ❌ 馬名、騎手名、レース名（文字化け）

**メリット**:
- ⚡ **今すぐ開始可能**
- ⚡ **30分で完了**
- ✅ RGS/AAS計算に必要な数値データは全て取得

**デメリット**:
- ❌ 馬名・騎手名は別途取得が必要

---

### Option 3: JRA-VANデータ優先（推奨15分）

**ZEDは後回しにして、JRA-VANの2,121,020件をまず活用**

**メリット**:
- ⚡⚡ **最速（15分）**
- ✅ 既存データですぐRGS/AAS計算開始

**デメリット**:
- ❌ JRDBデータは未使用

---

## 💡 CSO推奨：Option 2 → Option 1

### フェーズ1: 数値データのみ（30分）
1. 現在のファイルから数値データを抽出
2. jrdb_zed_numeric テーブルに格納
3. RGS/AAS計算の基礎データとして使用

### フェーズ2: 完全データ（後日）
1. 元のShift-JISファイルを取得
2. 馬名・騎手名などを追加
3. データを完全化

---

## 📋 CEO への質問

**どのOptionで進めますか？**

1. **Option 1**: 元のShift-JISファイルを共有（20分、最も正確）
2. **Option 2**: 数値データのみで進める（30分、バランス型）**← 推奨**
3. **Option 3**: JRA-VAN優先（15分、最速）

---

**作成日時**: 2026-01-04
**ステータス**: CEOの決定待ち
**緊急度**: 高
