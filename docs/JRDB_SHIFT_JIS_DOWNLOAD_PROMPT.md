# JRDB Shift_JIS版データ一括ダウンロード方法調査プロンプト

## 目的
JRDB（日本競馬データベース）から、Shift_JIS エンコーディングの競馬データファイルを一括ダウンロードする方法を調査する。

---

## 背景状況

### プロジェクト概要
- **プロジェクト名**: UMAYOMI（競馬予測システム）
- **開発フェーズ**: Phase 4 - 蹄データ抽出実装
- **目標**: JRDBの蹄データ（KYI/ZKB形式）をPostgreSQLに格納

### 現状の問題
1. **エンコーディング問題**: 既存のファイルがUTF-8に変換済みで、元のShift_JISデータが失われている
2. **文字化け**: UTF-8で読んだShift_JISファイルのため、日本語部分が `�Z�B` などに文字化け
3. **データ精度**: バイト位置ベースのパース（163-165, 280-282, 283-285バイト目）にはShift_JIS必須

### CEO環境
- **OS**: Windows 11
- **データ保存先**: `E:\UMAYOMI\jrdb_data\`
- **既存データ**: PACI250601フォルダ（14種類の.txtファイル、UTF-8変換済み）
- **JRDB会員**: 有効な会員ID保有
- **.lzhファイル**: ローカルに存在しない（既に解凍済みと思われる）

---

## 調査依頼内容

以下の情報を**具体的かつ実行可能な形**で調査してください：

### 1. JRDB公式サイトからのダウンロード方法

#### 調査項目：
- **ダウンロードページのURL**（会員専用ページ）
- **アクセス手順**（ログイン後のナビゲーション）
- **ファイル選択方法**（日付指定、ファイル形式選択）
- **一括ダウンロードの可否**（複数日付を一度にDL可能か）
- **ファイル形式**（.lzh / .zip / .tar.gz など）
- **エンコーディング保証**（ダウンロード時点でShift_JISが保証されるか）

#### 期待する回答例：
```
URL: https://www.jrdb.com/member/datazip/
手順:
1. ログイン後、左メニュー「JRDBデータ」→「データパックlzh圧縮版」をクリック
2. 年月日を選択（例: 2025年6月1日）
3. 「PACI250601.lzh」をチェック
4. 「ダウンロード実行」ボタンをクリック
5. ファイルはShift_JISで圧縮されている
```

---

### 2. JRDB Target（専用ソフト）の使用方法

#### 調査項目：
- **Target ソフトの入手方法**（ダウンロードURL、インストール手順）
- **Targetでのデータ取得手順**（スクリーンショット付きで説明されているページ）
- **一括ダウンロード機能の有無**（日付範囲指定で一括DL可能か）
- **エンコーディング設定**（Shift_JIS / UTF-8 の選択可否）
- **出力先フォルダ**（デフォルトの保存先）
- **ファイル形式**（.lzh のまま保存 or 自動解凍）

#### 期待する回答例：
```
入手先: https://www.jrdb.com/member/target/download.html
一括DL: 「期間指定ダウンロード」機能あり（2016-2025年を一括取得可能）
エンコーディング: 設定メニューから「Shift_JIS (CP932)」を選択
出力先: C:\JRDB\data\ （設定で変更可能）
```

---

### 3. 7-Zipでの正しい解凍方法

#### 調査項目：
- **Shift_JIS指定の解凍コマンド**（コマンドライン例）
- **GUI操作での設定方法**（スクリーンショット付きガイドのURL）
- **エンコーディング検証方法**（解凍後のファイルがShift_JISか確認する方法）

#### 期待する回答例：
```powershell
# コマンドライン
& "C:\Program Files\7-Zip\7z.exe" x "PACI250601.lzh" -o"E:\UMAYOMI\jrdb_data\PACI250601_SHIFT_JIS" -scsWIN -y

# -scsWIN: Shift_JIS (CP932) で解凍
# -y: 上書き確認なし
```

---

### 4. 代替ツール・方法

#### 調査項目：
- **他の解凍ソフト**（WinRAR, Lhaplus, Explzhなど）でのShift_JIS対応
- **Python/Node.jsスクリプト**（JRDB APIがあれば、プログラムでのDL方法）
- **JRA-VAN DataLab**（JRDBの代替データソース）

---

### 5. 一括ダウンロードの具体的手順

#### 最終的に必要な情報：
以下の形式で、**コピー&ペーストで実行できる手順書**を作成してください：

```markdown
## JRDB Shift_JIS版データ 一括ダウンロード手順（完全版）

### 前提条件
- JRDB会員ID: [CEOのID]
- Windows 11
- インターネット接続

### Step 1: JRDB Targetのインストール（15分）
1. [URL] にアクセス
2. [具体的な手順]
...

### Step 2: エンコーディング設定（5分）
1. Targetを起動
2. [設定メニューへの行き方]
...

### Step 3: 一括ダウンロード実行（30分）
1. [期間指定の方法]
2. [ダウンロード開始ボタン]
...

### Step 4: ファイル検証（5分）
1. [Shift_JIS確認コマンド]
...

### 合計所要時間: 約55分
```

---

## 調査の優先順位

1. **最優先**: JRDB公式サイトでの一括ダウンロード方法（最も確実）
2. **次点**: JRDB Target ソフトの使用方法（専用ツール）
3. **代替**: 7-Zipでの正しい解凍設定（既存.lzhファイルがある場合）

---

## 調査時の注意事項

### 必須確認事項
- ✅ **公式ドキュメントを優先**（非公式情報は避ける）
- ✅ **最新情報を確認**（2024-2025年の情報）
- ✅ **スクリーンショット付きガイドがあればURLを記載**
- ✅ **会員専用ページのURL**（ログイン後にアクセス可能なURL）

### 避けるべき情報
- ❌ 古い情報（2015年以前のフォーラム投稿など）
- ❌ 非公式ツール（安全性が不明なもの）
- ❌ 違法コピー・共有サイト

---

## 期待する最終成果物

以下のドキュメントを作成してください：

### ファイル名: `JRDB_SHIFT_JIS_BULK_DOWNLOAD_GUIDE.md`

### 内容構成:
```markdown
# JRDB Shift_JIS版データ 一括ダウンロード完全ガイド

## 目次
1. 概要
2. 前提条件
3. 方法1: JRDB公式サイト（推奨）
4. 方法2: JRDB Target ソフト
5. 方法3: 7-Zipでの解凍設定
6. トラブルシューティング
7. FAQ

## 1. 概要
[調査結果のサマリー]

## 2. 前提条件
- JRDB会員登録済み
- Windows 11
- 7-Zip インストール済み

## 3. 方法1: JRDB公式サイト（推奨）
### 3-1. アクセス方法
[具体的なURL・手順]

### 3-2. 一括ダウンロード手順
[ステップバイステップの手順]

### 3-3. エンコーディング確認
[PowerShellコマンド例]

## 4. 方法2: JRDB Target ソフト
[Target使用方法の詳細]

## 5. 方法3: 7-Zipでの解凍設定
[コマンドライン例・GUI設定方法]

## 6. トラブルシューティング
### 問題1: ファイルがUTF-8になってしまう
[解決策]

### 問題2: 文字化けが発生する
[解決策]

## 7. FAQ
Q1: 一度に何日分ダウンロードできますか？
A1: [調査結果]

Q2: Shift_JISが保証される方法は？
A2: [調査結果]
```

---

## 参考URL（調査開始点）

以下のURLから調査を開始してください：

1. **JRDB公式サイト**
   - トップ: https://www.jrdb.com/
   - 会員ページ: https://www.jrdb.com/member/
   - データダウンロード: https://www.jrdb.com/member/datazip/ （推測）

2. **JRDB公式ドキュメント**
   - データ仕様書: https://jrdb.com/data_introduction/
   - JRDBコード表: https://jrdb.com/data_introduction/jrdb_code.html
   - KYI仕様書: http://www.jrdb.com/program/Kyi/kyi_doc.txt
   - SKB仕様書: http://www.jrdb.com/program/Skb/skb_doc.txt

3. **関連ページ**
   - JRDB Target情報: https://www.jrdb.com/member/target/ （推測）
   - サポート: https://www.jrdb.com/support/

---

## 調査方法の推奨

### 検索キーワード（日本語）
```
"JRDB" "一括ダウンロード" "Shift_JIS"
"JRDB Target" "使い方"
"JRDB" "データパック" "lzh"
"JRDB" "エンコーディング" "文字化け"
"JRDB" "期間指定" "ダウンロード"
```

### 検索キーワード（英語）
```
"JRDB" "bulk download" "encoding"
"JRDB API" "documentation"
```

---

## 最終確認事項

調査完了後、以下を確認してください：

- [ ] 一括ダウンロードの方法が明確に記載されているか
- [ ] Shift_JISエンコーディングが保証される方法か
- [ ] コピー&ペーストで実行できる具体的なコマンド・手順が含まれているか
- [ ] 所要時間の目安が記載されているか
- [ ] トラブルシューティングセクションがあるか
- [ ] 公式情報源のURLが記載されているか

---

## 補足: 技術的背景

### なぜShift_JISが必須なのか
JRDB競馬データは固定長フォーマット（KYI: 1024バイト、ZKB: 304バイト）で、バイト位置で各フィールドを抽出します：

- **KYI 蹄コード**: 163-165バイト目（2桁）
- **ZKB 蹄鉄コード**: 280-282バイト目（3桁）
- **ZKB 蹄状態コード**: 283-285バイト目（3桁）

UTF-8では日本語が可変長（1-4バイト）になるため、バイト位置がずれて正確な抽出が不可能になります。Shift_JISでは日本語が固定2バイトなので、公式仕様通りのバイト位置でパースできます。

### データ量
- **期間**: 2016-2025年（約10年間）
- **日数**: 約1,043日分
- **ファイル数**: 約14,602ファイル（1日14種類 × 1,043日）
- **総データ量**: 約1GB（JRDB 508MB + TFJV 455MB）

---

## 最終目標

このプロンプトで調査した結果を基に、CEOが以下を実行できるようにする：

1. ✅ **Shift_JIS版ファイルを一括ダウンロード**（1時間以内）
2. ✅ **エンコーディングを検証**（PowerShellコマンドで確認）
3. ✅ **KYI250601.txt / ZKB250601.txt をアップロード**
4. ✅ **蹄データ抽出を実行**（Phase 4完了）

---

**UMAYOMI - 馬を読む。レースが変わる。**

このプロンプトを別セッションで使用して、JRDB Shift_JIS版データの一括ダウンロード方法を徹底調査してください！
