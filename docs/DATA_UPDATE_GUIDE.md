# UMAYOMI データ期間更新ガイド

## 📅 年次データ更新手順

年が変わったとき（例: 2026年1月）に、データ期間を更新する手順です。

---

## 🎯 **更新が必要なケース**

- **2026年1月1日以降**: 2017年〜2026年のデータに更新
- **2027年1月1日以降**: 2018年〜2027年のデータに更新
- **以降、毎年同様**

---

## 🔧 **更新手順 (3ステップ)**

### **Step 1: データ抽出スクリプトを実行**

1. エクスプローラーで以下を開く:
   ```
   E:\UMAYOMI\umayomi\internal-analysis-tool\scripts\update_data_period.bat
   ```

2. ファイルを**右クリック** → **編集** (メモ帳で開く)

3. 以下の行を変更:
   ```batch
   set START_YEAR=2016
   set END_YEAR=2025
   ```
   
   **例: 2026年の場合**
   ```batch
   set START_YEAR=2017
   set END_YEAR=2026
   ```

4. **保存**して閉じる

5. `update_data_period.bat` をダブルクリックして実行

6. 「この設定でデータ抽出を開始しますか？」と表示されたら **Enter** を押す

7. 抽出完了まで待つ (約 3〜5分)

---

### **Step 2: Python 設定ファイルを更新**

1. エクスプローラーで以下を開く:
   ```
   E:\UMAYOMI\umayomi\internal-analysis-tool\config\data_config.py
   ```

2. ファイルを**右クリック** → **編集** (メモ帳で開く)

3. 以下の行を変更:
   ```python
   DATA_START_YEAR = 2016
   DATA_END_YEAR = 2025
   ```
   
   **例: 2026年の場合**
   ```python
   DATA_START_YEAR = 2017
   DATA_END_YEAR = 2026
   ```

4. **保存**して閉じる

---

### **Step 3: データパス検証**

1. コマンドプロンプトを開く

2. 以下のコマンドを実行:
   ```cmd
   cd E:\UMAYOMI\umayomi\internal-analysis-tool
   python config\data_config.py
   ```

3. 以下のような表示が出れば成功:
   ```
   ==================================================
   UMAYOMI データ設定
   ==================================================
   
   データ期間: 2017 - 2026 (10年分)
   JRDB パス: E:/UMAYOMI/jrdb_data_2017-2026
   TFJV パス: E:/UMAYOMI/tfjv_data_2017-2026
   
   パス検証中...
   ✅ データパス検証成功:
     - JRDB: E:/UMAYOMI/jrdb_data_2017-2026
     - TFJV: E:/UMAYOMI/tfjv_data_2017-2026
   ```

---

## 📊 **年次更新のタイミング**

### **推奨: 毎年1月中旬**

- **理由**: 前年12月のデータが完全に揃ってから実行
- **タイミング**: 1月15日以降

### **年次更新の例:**

| 実行時期 | データ期間 | START_YEAR | END_YEAR |
|---------|----------|------------|----------|
| 2025年12月 | 2016-2025 | 2016 | 2025 |
| 2026年1月 | 2017-2026 | 2017 | 2026 |
| 2027年1月 | 2018-2027 | 2018 | 2027 |
| 2028年1月 | 2019-2028 | 2019 | 2028 |

---

## ⚠️ **注意事項**

1. **古いデータは削除されない**
   - 過去の期間のデータ (`E:\UMAYOMI\jrdb_data_2016-2025`) は残ります
   - ストレージを節約したい場合は手動で削除してください

2. **データベースのリセットが必要**
   - データ期間を変更したら、PostgreSQL のデータをリセット
   - 詳細は「データベース管理ガイド」を参照

3. **バックアップを推奨**
   - データ更新前に、現在の分析結果をバックアップ
   - ファクター定義も保存しておくこと

---

## 🔄 **自動化オプション (将来実装)**

将来的には、以下の自動化も検討:

1. **年次更新の自動検出**
   - 現在の年を自動判定
   - データ期間を自動更新

2. **スケジュール実行**
   - Windows タスクスケジューラで毎年1月15日に自動実行

3. **通知機能**
   - データ更新が必要なタイミングで通知

---

## 📝 **更新履歴**

| 日付 | データ期間 | 実行者 | 備考 |
|------|----------|--------|------|
| 2025-12-29 | 2016-2025 | CEO | 初期設定 |
|  |  |  |  |

---

## 💡 **トラブルシューティング**

### **問題: データ抽出に失敗する**

**原因**: ソースデータのパスが間違っている

**解決策**:
1. `update_data_period.bat` を開く
2. `SOURCE_JRDB` と `SOURCE_TFJV` のパスを確認
3. 正しいパスに修正

---

### **問題: パス検証に失敗する**

**原因**: データ抽出がまだ完了していない

**解決策**:
1. `update_data_period.bat` を再実行
2. 抽出完了まで待つ
3. 再度 `python config\data_config.py` を実行

---

## 📞 **サポート**

問題が解決しない場合は、以下の情報を確認:
1. エラーメッセージのスクリーンショット
2. 実行したコマンド
3. 現在のデータ期間設定

---

**UMAYOMI - 馬を読む。レースが変わる。**
