# UMAYOMI Phase 4 - プロジェクトサマリー

---

## 🎯 **プロジェクト概要**

**UMAYOMI (馬を読む。レースが変わる。)** は、JRDB + JRA-VAN データを活用した競馬分析システムです。

---

## 📊 **データ資産**

### **データソース**
| データソース | 期間 | ファイル数 | サイズ | 場所 |
|-------------|------|-----------|--------|------|
| JRDB | 2016-2025 | 1,043 | 508 MB | E:\UMAYOMI\jrdb_data_2016-2025 |
| TFJV (JRA-VAN) | 2016-2025 | 1,450 | 455 MB | E:\UMAYOMI\tfjv_data_2016-2025 |
| **合計** | **10年** | **2,493** | **約1GB** | **E:\UMAYOMI\** |

### **分析可能なレース数**
- **開催日数**: 1,043日 (JRA開催は土日祝中心で年間約100-110日)
- **総レース数**: 約10,430レース
- **分析項目数**: 1,000～1,200項目

---

## 🗂️ **データ構造 (14種類)**

### **Layer 1: レース・成績・馬基本情報**
1. **ZED**: レース詳細データ (2,110レコード/日, 23フィールド)
2. **ZKB**: 成績指数データ (1,980レコード/日, 32フィールド)
3. **BAC**: 馬別成績データ (36レコード/日, 21フィールド)

### **Layer 2: 調教・騎手・馬データ**
4. **CYB**: 調教データ (501レコード/日, 15フィールド)
5. **JOA**: 騎手データ (501レコード/日, 14フィールド)
6. **KKA**: 馬基本データ (501レコード/日, 22フィールド)
7. **UKC**: 馬成績データ詳細 (501レコード/日, 36フィールド)
8. **KYI**: 競走馬詳細データ (501レコード/日, 34フィールド)

### **Layer 3: オッズ・コメントデータ**
9. **OT**: 単勝・複勝オッズ (36レコード/日, 3フィールド)
10. **OU**: 馬連オッズ (36レコード/日, 2フィールド)
11. **OW**: ワイドオッズ (36レコード/日, 2フィールド)
12. **OZ**: 3連複オッズ (36レコード/日, 2フィールド)
13. **CHA**: 厩舎コメント (501レコード/日, 10フィールド)
14. **KAB**: 馬柱データ (3レコード/日, 16フィールド)

**1日あたりの総レコード数**: 7,279レコード  
**10年分の総レコード数**: 約7,590,000レコード

---

## 📂 **プロジェクト構造**

```
webapp/
├── config/
│   └── data_config.py              # データ期間設定 (2016-2025)
├── parsers/
│   └── jrdb_parser.py              # JRDB全14種類パーサー
├── scripts/
│   ├── update_data_period.bat      # 年次更新スクリプト (Windows)
│   └── create_tables.py            # PostgreSQLテーブル作成
├── data_import/
│   └── (将来: インポートスクリプト)
├── tests/
│   └── (将来: テストコード)
├── docs/
│   ├── DATA_UPDATE_GUIDE.md        # 年次更新ガイド
│   ├── DATABASE_SCHEMA.md          # データベース設計書
│   └── DAY2_COMPLETION_REPORT.md   # Day 2完了レポート
└── README.md                       # プロジェクト概要
```

---

## 🚀 **Phase 4 進捗**

### **Week 1: JRDB データ基盤構築**

#### ✅ **Day 1 完了** (2025-12-28)
- データ移行完了 (C:\JRDB → E:\UMAYOMI)
- JRDB 11年分データ確認 (2014-2025, 5,056日)
- TFJV 71年分データ発見 (1954-2026)
- データ期間絞り込み (2016-2025, 1,043日)
- 年次更新機能実装

#### ✅ **Day 2 完了** (2025-12-29)
- JRDB全14種類パーサー実装
- PostgreSQLテーブル設計 (14テーブル)
- CREATE TABLEスクリプト作成
- パーサーテスト実行 (7,279レコード/日確認)

#### ⏳ **Day 3 予定** (2025-12-30)
- PostgreSQLインストール・設定
- 全14テーブル作成実行
- サンプルデータインポートテスト
- データ整合性チェック

#### ⏳ **Day 4 予定** (2025-12-31)
- 1,043日分の全データインポート
- インポート進捗モニタリング
- エラーハンドリング

#### ⏳ **Day 5 予定** (2026-01-01)
- SQL生成エンジン実装
  - ファクター条件 → SQL変換
  - 14テーブル結合クエリ
  - 和文条件表示
  - 件数カウント機能

### **Week 2: TFJV統合 + 分析エンジン**

#### ⏳ **Day 6 予定**
- TFJVデータ構造解析
- TFJVパーサー実装

#### ⏳ **Day 7 予定**
- JRDB + TFJV統合
- データ結合テスト

#### ⏳ **Day 8 予定**
- 回収率分析エンジン実装
  - 基本回収率計算
  - 補正回収率計算
  - 時系列分析

#### ⏳ **Day 9 予定**
- 統合テスト
- バックテスト (10年分)

#### ⏳ **Day 10 予定**
- UI統合
- 最終調整
- リリース準備

---

## 💻 **技術スタック**

### **言語・フレームワーク**
- **Python 3.14**: データ処理・パーサー
- **PostgreSQL 17**: データベース
- **Streamlit**: UI (将来)

### **ライブラリ**
- **psycopg2-binary**: PostgreSQL接続
- **pandas**: データ分析 (将来)
- **numpy**: 数値計算 (将来)

---

## 🎯 **主要機能 (完成時)**

### **1. データ管理**
- [x] JRDBデータパース (全14種類)
- [ ] TFJVデータパース (20種以上)
- [x] PostgreSQLデータベース設計
- [ ] データインポート自動化
- [x] 年次更新機能

### **2. 分析機能**
- [ ] ファクター条件検索
- [ ] SQL自動生成
- [ ] 回収率分析
- [ ] バックテスト
- [ ] 独自点計算

### **3. UI機能**
- [ ] レース検索
- [ ] 馬検索
- [ ] 騎手検索
- [ ] 調教師検索
- [ ] 条件保存・共有

---

## 📈 **データ量推定**

### **PostgreSQLデータベース**
| テーブル | 1日あたり | 10年間合計 | サイズ推定 |
|---------|---------|-----------|----------|
| races | 10 | 10,430 | 1 MB |
| race_results | 1,980 | 2,065,140 | 200 MB |
| horse_records | 36 | 37,548 | 4 MB |
| training_data | 501 | 522,543 | 50 MB |
| jockey_stats | 501 | 522,543 | 50 MB |
| horse_master | 501 | 522,543 | 50 MB |
| horse_performance | 501 | 522,543 | 50 MB |
| horse_details | 501 | 522,543 | 50 MB |
| odds_tansho_fukusho | 36 | 37,548 | 5 MB |
| odds_umaren | 36 | 37,548 | 5 MB |
| odds_wide | 36 | 37,548 | 5 MB |
| odds_sanrenpuku | 36 | 37,548 | 5 MB |
| trainer_comments | 501 | 522,543 | 50 MB |
| horse_columns | 3 | 3,129 | 1 MB |
| **合計** | **7,279** | **7,591,997** | **約526 MB** |

**インデックス込み**: 約700-800 MB

---

## 🔐 **データベース接続設定**

### **PostgreSQL設定**
```python
DATABASE_CONFIG = {
    'host': 'localhost',
    'port': 5432,
    'database': 'umayomi_db',
    'user': 'umayomi_user',
    'password': 'umayomi2024'
}
```

---

## 🎓 **年次更新ガイド**

### **2026年以降の更新手順**
1. **update_data_period.bat** を編集
   ```batch
   set START_YEAR=2017
   set END_YEAR=2026
   ```

2. **data_config.py** を編集
   ```python
   DATA_START_YEAR = 2017
   DATA_END_YEAR = 2026
   ```

3. **update_data_period.bat** をダブルクリックで実行
   - 自動的に 2017-2026 のデータが抽出される

---

## 📝 **重要ファイル**

### **設定ファイル**
- `config/data_config.py`: データ期間設定
- `scripts/update_data_period.bat`: 年次更新スクリプト

### **パーサー**
- `parsers/jrdb_parser.py`: JRDB全14種類パーサー

### **スクリプト**
- `scripts/create_tables.py`: PostgreSQLテーブル作成

### **ドキュメント**
- `docs/DATA_UPDATE_GUIDE.md`: 年次更新ガイド
- `docs/DATABASE_SCHEMA.md`: データベース設計書
- `docs/DAY2_COMPLETION_REPORT.md`: Day 2完了レポート

---

## 🌟 **Enable憲法の実践**

### **10x Mindset**
- 10年分のデータで10,430レースを分析可能
- 約1,200項目の分析軸で独自性を確立

### **Be Resourceful**
- JRDB + TFJV の統合で相乗効果を実現
- 年次更新の自動化で将来の時間を買う

### **Play to Win**
- バックテスト機能で勝つための戦略を構築
- 独自点計算で競合との差別化

### **Buy Back Time**
- 再利用可能なパーサーで開発時間を削減
- 自動化スクリプトで手作業を排除

---

## 📞 **連絡先**

**プロジェクト名**: UMAYOMI  
**CEO**: Enable株式会社  
**モットー**: 馬を読む。レースが変わる。

---

**最終更新日**: 2025年12月29日  
**Phase 4 進捗**: 28.6% (2/7日完了)
